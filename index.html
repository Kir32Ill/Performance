<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Яндекс.Дом</title>
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="styles.css">
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        "use strict";
        const TABS = {
            all: {
                title: 'Все',
                items: Array(256).fill().map((_,i) => ({
                    icon: i%2 ? 'light' : 'light2',
                    iconLabel: 'Освещение',
                    title: `Устройство ${i+1}`,
                    subtitle: i%3 ? 'Включено' : 'Выключено'
                }))
            },
            kitchen: {
                title: 'Кухня',
                items: [
                    {icon: 'light2', iconLabel: 'Освещение', title: 'Xiaomi Yeelight', subtitle: 'Включено'},
                    {icon: 'temp', iconLabel: 'Температура', title: 'Elgato Eve', subtitle: 'Выключено'}
                ]
            },
            hall: {
                title: 'Зал',
                items: [
                    {icon: 'light', iconLabel: 'Освещение', title: 'Philips Zhirui', subtitle: 'Выключено'},
                    {icon: 'light2', iconLabel: 'Освещение', title: 'Xiaomi Air', subtitle: 'Выключено'}
                ]
            }
        };

        function createElement(tag, attrs, ...children) {
            const el = document.createElement(tag);
            if (attrs) {
                for (const [key, value] of Object.entries(attrs)) {
                    if (key === 'className') el.className = value;
                    else if (key.startsWith('on')) el.addEventListener(key.slice(2), value);
                    else el.setAttribute(key, value);
                }
            }
            children.forEach(child => {
                if (typeof child === 'string') el.textContent = child;
                else if (child) el.appendChild(child);
            });
            return el;
        }

        function createEvent({slim, icon, iconLabel, title, subtitle}) {
            return createElement('li', {
                className: slim ? 'event event_slim' : 'event'
            },
                createElement('button', {className: 'event__button'},
                    createElement('span', {
                        className: `event__icon event__icon_${icon}`,
                        'aria-label': iconLabel,
                        role: 'img'
                    }),
                    createElement('h4', {className: 'event__title'}, title),
                    subtitle && createElement('span', {className: 'event__subtitle'}, subtitle)
                )
            );
        }
        function createApp() {
            const app = document.getElementById('app');
            const header = createElement('header', {className: 'header'},
                createElement('a', {
                    className: 'header__logo',
                    href: '/',
                    'aria-label': 'Яндекс.Дом'
                }),
                createElement('button', {
                    className: 'header__menu',
                    'aria-expanded': 'false',
                    onClick: toggleMenu
                },
                    createElement('span', {className: 'header__menu-text a11y-hidden'}, 'Меню')
                ),
                createElement('ul', {className: 'header__links'},
                    createNavItem('Сводка', '/', true),
                    createNavItem('Устройства', '/devices'),
                    createNavItem('Сценарии', '/scripts')
                )
            );
            const main = createElement('main', {className: 'main'},
                createGeneralSection(),
                createScriptsSection(),
                createDevicesSection()
            );

            app.appendChild(header);
            app.appendChild(main);
        }

        function createNavItem(text, href, isCurrent = false) {
            return createElement('li', {className: 'header__item'},
                createElement('a', {
                    className: isCurrent ? 'header__link header__link_current' : 'header__link',
                    href: href,
                    ...(isCurrent && {'aria-current': 'page'})
                }, text)
            );
        }

        function createGeneralSection() {
            return createElement('section', {className: 'section main__general'},
                createElement('h2', {className: 'section__title section__title-header section__main-title'}, 'Главное'),
                createElement('div', {className: 'hero-dashboard'},
                    createElement('div', {className: 'hero-dashboard__primary'},
                        createElement('h3', {className: 'hero-dashboard__title'}, 'Привет, Геннадий!'),
                        createElement('p', {className: 'hero-dashboard__subtitle'}, 
                            'Двери и окна закрыты, сигнализация включена.'
                        ),
                        createElement('ul', {className: 'hero-dashboard__info'},
                            createDashboardItem('Дома', '+23'),
                            createDashboardItem('За окном', '+19', 'rain')
                        )
                    ),
                    createElement('ul', {className: 'hero-dashboard__schedule'},
                        createEvent({
                            icon: 'temp',
                            iconLabel: 'Температура',
                            title: 'Philips Cooler',
                            subtitle: 'Начнет охлаждать в 16:30'
                        }),
                        createEvent({
                            icon: 'light',
                            iconLabel: 'Освещение',
                            title: 'Xiaomi Yeelight',
                            subtitle: 'Включится в 17:00'
                        })
                    )
                )
            );
        }

        function createDashboardItem(title, value, icon = null) {
            return createElement('li', {className: 'hero-dashboard__item'},
                createElement('div', {className: 'hero-dashboard__item-title'}, title),
                createElement('div', {className: 'hero-dashboard__item-details'},
                    value,
                    createElement('span', {className: 'a11y-hidden'}, '°'),
                    icon && createElement('div', {
                        className: `hero-dashboard__icon hero-dashboard__icon_${icon}`,
                        'aria-label': icon === 'rain' ? 'Дождь' : '',
                        role: 'img'
                    })
                )
            );
        }

        function createScriptsSection() {
            const scripts = [
                {icon: 'light2', iconLabel: 'Освещение', title: 'Выключить весь свет'},
                {icon: 'schedule', iconLabel: 'Расписание', title: 'Я ухожу'},
                {icon: 'light2', iconLabel: 'Освещение', title: 'Включить свет'},
                {icon: 'temp2', iconLabel: 'Температура', title: 'Набрать ванну', subtitle: 'Начнётся в 18:00'},
                {icon: 'temp2', iconLabel: 'Температура', title: 'Тёплый пол'}
            ];

            return createElement('section', {className: 'section main__scripts'},
                createElement('h2', {className: 'section__title section__title-header'}, 'Избранные сценарии'),
                createElement('ul', {className: 'event-grid'},
                    ...scripts.map(props => createEvent({...props, slim: true}))
                )
            );
        }

        function createDevicesSection() {
            const tabKeys = Object.keys(TABS);
            let currentTab = 'all';

            const section = createElement('section', {className: 'section main__devices'},
                createElement('div', {className: 'section__title'},
                    createElement('h2', {className: 'section__title-header'}, 'Избранные устройства'),
                    createSelect(tabKeys),
                    createTabs(tabKeys)
                ),
                createElement('div', {className: 'section__panel-wrapper'},
                    ...tabKeys.map(key => createPanel(key, key === currentTab))
                )
            );

            function createSelect(keys) {
                const select = createElement('select', {
                    className: 'section__select',
                    onInput: (e) => {
                        currentTab = e.target.value;
                        updateTabs();
                    }
                });
                
                keys.forEach(key => {
                    select.appendChild(
                        createElement('option', {value: key}, TABS[key].title)
                    );
                });
                
                return select;
            }

            function createTabs(keys) {
                const tabs = createElement('ul', {
                    className: 'section__tabs',
                    role: 'tablist'
                });
                
                keys.forEach(key => {
                    tabs.appendChild(
                        createElement('li', {
                            className: `section__tab${key === currentTab ? ' section__tab_active' : ''}`,
                            role: 'tab',
                            'aria-selected': key === currentTab,
                            'aria-controls': `panel_${key}`,
                            id: `tab_${key}`,
                            onClick: () => {
                                currentTab = key;
                                updateTabs();
                            }
                        }, TABS[key].title)
                    );
                });
                
                return tabs;
            }

            function createPanel(key, isActive) {
                return createElement('div', {
                    className: `section__panel${isActive ? '' : ' section__panel_hidden'}`,
                    role: 'tabpanel',
                    'aria-labelledby': `tab_${key}`,
                    id: `panel_${key}`,
                    'aria-hidden': !isActive
                },
                    createElement('ul', {className: 'section__panel-list'},
                        ...TABS[key].items.map(item => createEvent(item))
                    )
                );
            }

            function updateTabs() {
                section.querySelectorAll('.section__tab').forEach(tab => {
                    const isActive = tab.textContent === TABS[currentTab].title;
                    tab.classList.toggle('section__tab_active', isActive);
                    tab.setAttribute('aria-selected', isActive);
                });

                section.querySelector('.section__select').value = currentTab;
                section.querySelectorAll('.section__panel').forEach(panel => {
                    const isActive = panel.id === `panel_${currentTab}`;
                    panel.classList.toggle('section__panel_hidden', !isActive);
                    panel.setAttribute('aria-hidden', !isActive);
                });
            }

            return section;
        }

        function toggleMenu() {
            const menu = this;
            const expanded = menu.getAttribute('aria-expanded') === 'true';
            menu.setAttribute('aria-expanded', !expanded);
            document.querySelector('.header__links').classList.toggle('header__links_opened');
        }

        // Инициализация
        createApp();
    });
    </script>
</head>
<body>
    <div id="app"></div>
    <footer class="footer">
        <ul class="footer__list">
            <li><a class="footer__link" href="/">Помощь</a></li>
            <li><a class="footer__link" href="/">Обратная связь</a></li>
            <li><a class="footer__link" href="/">Разработчикам</a></li>
            <li><a class="footer__link" href="/">Условия использования</a></li>
        </ul>
        <div class="footer__copyright">© 1997–2023 ООО «Яндекс»</div>
    </footer>
</body>
</html>